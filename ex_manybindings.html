<html>

<head>
    <script>
        window.times = { first: Date.now() }
    </script>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        crossorigin="anonymous">
    <link rel="stylesheet" href="./index.css" crossorigin="anonymous">
    <script src="./m-control.js"></script>
    <script src="./m-example.js"></script>
    <script>
        times.start_script = Date.now()
        const N = 1000
        window.addEventListener('load', _ => {
            times.onload_begin = Date.now()

            class MCtrlExample extends MC.Controller {

                constructor(element) {
                    super(element)
                    times.ctor_start = Date.now()
                    this.model.table = Array(N).fill().map((_, i) => { return { A: 11, B: 12, C: 13, D: 14, E: 15, F: 16, G: 17, H: 18, I: 19, J: 20, } })
                    times.ctor_end = Date.now()
                }
                init() {
                    times.start_init = Date.now()

                    for (let i = 0; i < N; i++) {
                        const elem = document.createElement('tr')
                        elem.innerHTML=`
                            <td><div>${i}</div></td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].A" size=5/></div></td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].B" size=5/> </div></td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].C" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].D" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].E" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].F" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].G" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].H" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].I" size=5/></div> </td>
                            <td><div><input type="number" onfocus="this.select()" onmouseup="return false;" m-bind:value="µ.table[${i}].J" size=5/></div> </td>
                            <td><div>{{ this.sum(${i}) }}</p></td>
                        `
                        this.refs.tbody.appendChild(elem)
                    }
                    this.$build(this.refs.tbody)
                    setInterval(_ => {
                        for (let i = 0; i < N / 10; i++) {
                            const index = Math.floor(N * Math.random())
                            const prop = "ABCDEFGHIJ"[Math.floor(10 * Math.random())]
                            this.model.table[index][prop] = Math.floor(100000 * Math.random())
                        }
                    }, 200)
                    times.end_init = Date.now()
                    let prev = null
                    Object.keys(times).forEach(k => {
                        prev && console.log(`${prev} => ${k} duration = ${times[k] - times[prev]}ms`)
                        prev = k
                    })
                }
                sum(i) {
                    const obj = this.model.table[i]
                    const sum = Object.keys(obj).reduce((sum,letter) => sum + parseInt(obj[letter]), 0)
                    return sum
                }
            }
            MControl.register(MCtrlExample)
            MControl.start()
            times.onload_end = Date.now()
        })
        times.end_script = Date.now()
    </script>
</head>

<body class=pure>


    <h1> large set of bindings performance testing event handler to an HTML element
        <hr>
    </h1>
    <p>In this example we bind a lot of iput event to see performance.</p>

    <fieldset m-control="MCtrlExample">
        <input m-on:click="this.code()" style="float: right;" type=button value="see code">

        <legend>The demo :</legend>
        <table class="pure-table pure-table-bordered">
            <thead>
                <tr>
                    </script>
                    <td>#</td>
                    <td>A</td>
                    <td>B</td>
                    <td>C</td>
                    <td>D</td>
                    <td>E</td>
                    <td>F</td>
                    <td>G</td>
                    <td>H</td>
                    <td>I</td>
                    <td>J</td>
                    <td>total</td>
                </tr>
            </thead>
            <tbody m-ref=tbody>
            </tbody>
        </table>
    </fieldset>
</body>

</html>